{
  "skill_name": "analyze-gitops-repo",
  "evals": [
    {
      "id": 1,
      "prompt": "Clone https://github.com/fluxcd/flux2-kustomize-helm-example.git (shallow, HEAD only) into the workspace/ dir, analyze it as a GitOps repository, provide a complete analysis report, then delete the cloned directory.",
      "expected_output": "A comprehensive analysis report identifying this as a monorepo pattern with two clusters (staging and production), covering structure, validation, API compliance, best practices, and recommendations.",
      "files": [],
      "expectations": [
        "Clones the repo with --depth=1 into a temp directory and cleans up after analysis",
        "Identifies the repository as a monorepo pattern with apps/infrastructure/clusters structure",
        "Detects two clusters: staging and production",
        "Identifies ArtifactGenerator usage for monorepo decomposition into ExternalArtifacts",
        "Finds HelmRelease, HelmRepository, OCIRepository, and Kustomization resources",
        "Notes the dependency chain: infra-controllers depends on nothing, infra-configs depends on infra-controllers, apps depends on infra-configs",
        "Recognizes the Kustomize base/overlay pattern in apps/ with per-environment patches",
        "Runs the bundled validate.sh script or notes if prerequisites are missing",
        "Checks for deprecated API versions and reports findings",
        "Produces a structured report with summary, structure, validation, best practices, and recommendations sections"
      ]
    },
    {
      "id": 2,
      "prompt": "Clone https://github.com/controlplaneio-fluxcd/d2-fleet.git (shallow, HEAD only) into the workspace/ dir, analyze it as a GitOps repository, provide a complete analysis report, then delete the cloned directory.",
      "expected_output": "A comprehensive analysis report identifying this as an OCI-based multi-repo fleet management pattern using FluxInstance and ResourceSet.",
      "files": [],
      "expectations": [
        "Clones the repo with --depth=1 into a temp directory and cleans up after analysis",
        "Identifies the repository as an OCI-based multi-repo fleet management pattern",
        "Detects FluxInstance resources for declarative Flux installation",
        "Identifies ResourceSet resources for templated multi-tenant resource generation",
        "Detects multiple clusters (staging, prod-eu, prod-us)",
        "Notes the OCI artifact sync strategy with tag promotion (latest vs latest-stable)",
        "Identifies ValidatingAdmissionPolicy for source allowlist enforcement",
        "Notes Cosign signature verification on OCI sources",
        "Produces a structured report with recommendations"
      ]
    },
    {
      "id": 3,
      "prompt": "Clone https://github.com/controlplaneio-fluxcd/d1-apps.git (shallow, HEAD only) into the workspace/ dir, analyze it as a GitOps repository, provide a complete analysis report, then delete the cloned directory.",
      "expected_output": "A comprehensive analysis report identifying this as an application repo in a Git-based multi-repo setup with HelmRelease configurations and image automation.",
      "files": [],
      "expectations": [
        "Clones the repo with --depth=1 into a temp directory and cleans up after analysis",
        "Identifies the repository as an application repo in a multi-repo GitOps setup",
        "Finds HelmRelease resources for frontend (podinfo) and backend (redis, memcached) components",
        "Notes the base/staging/production overlay pattern under components/",
        "Detects image automation setup (ImageRepository and ImagePolicy in update/ directory)",
        "Checks HelmRelease configurations for drift detection settings",
        "Notes that some HelmReleases use the older install.remediation.retries pattern",
        "Produces a structured report with best practices assessment and recommendations"
      ]
    },
    {
      "id": 4,
      "prompt": "Clone https://github.com/controlplaneio-fluxcd/d1-infra.git (shallow, HEAD only) into the workspace/ dir, analyze it as a GitOps repository, provide a complete analysis report, then delete the cloned directory.",
      "expected_output": "A comprehensive analysis report identifying this as an infrastructure repo with controllers/configs separation, HelmReleases for cluster add-ons, and image automation.",
      "files": [],
      "expectations": [
        "Clones the repo with --depth=1 into a temp directory and cleans up after analysis",
        "Identifies the repository as an infrastructure repo in a multi-repo GitOps setup",
        "Detects the controllers/configs separation pattern under each component (admission, monitoring)",
        "Finds HelmRelease resources for Kyverno and kube-prometheus-stack",
        "Notes drift detection configuration on monitoring HelmRelease",
        "Detects CRD handling strategy (install.crds: Create, upgrade.crds: CreateReplace)",
        "Identifies image automation for chart version updates in update/ directory",
        "Produces a structured report with recommendations"
      ]
    },
    {
      "id": 5,
      "prompt": "Clone https://github.com/controlplaneio-fluxcd/d1-fleet.git (shallow, HEAD only) into the workspace/ dir, analyze it as a GitOps repository, provide a complete analysis report, then delete the cloned directory.",
      "expected_output": "A comprehensive analysis report identifying this as a Git-based multi-repo fleet management pattern with multi-tenant RBAC, Kyverno policies, and postBuild substitution.",
      "files": [],
      "expectations": [
        "Clones the repo with --depth=1 into a temp directory and cleans up after analysis",
        "Identifies the repository as a Git-based fleet management repo in a multi-repo setup",
        "Detects multiple clusters (staging, prod-eu, prod-us)",
        "Finds the tenant structure with separate infra and apps tenant configurations",
        "Notes multi-tenancy enforcement: dedicated service accounts, RoleBindings, no-cross-namespace-refs",
        "Identifies postBuild.substituteFrom using ConfigMaps for cluster-specific variables",
        "Detects ImageUpdateAutomation for automated version bumps across repos",
        "Notes security hardening in flux-system kustomization patches (resource limits, concurrency, caching)",
        "Produces a structured report with recommendations"
      ]
    },
    {
      "id": 6,
      "prompt": "Analyze the tests/analyze-gitops-repo/deprecated-apis/ directory as a GitOps repository and provide a complete analysis report.",
      "expected_output": "A report flagging multiple deprecated Flux API versions across all resource types, recommending migration to current versions, and noting gotk-sync.yaml means flux bootstrap is used.",
      "files": [],
      "expectations": [
        "Detects GitRepository using source.toolkit.fluxcd.io/v1beta1 (should be v1)",
        "Detects Kustomization using kustomize.toolkit.fluxcd.io/v1beta1 and v1beta2 (should be v1)",
        "Detects HelmRelease using helm.toolkit.fluxcd.io/v2beta1 and v2beta2 (should be v2)",
        "Detects HelmRepository using source.toolkit.fluxcd.io/v1beta1 and v1beta2 (should be v1)",
        "Detects Provider using notification.toolkit.fluxcd.io/v1beta1 (should be v1beta3)",
        "Detects Alert using notification.toolkit.fluxcd.io/v1beta2 (should be v1beta3)",
        "Flags HelmRepository with type: oci as legacy, recommends migration to OCIRepository",
        "Detects gotk-sync.yaml and recommends migrating to Flux Operator with link to https://fluxoperator.dev/docs/guides/migration/",
        "Reports overall status as critical-issues due to deprecated APIs",
        "Produces a structured report with API compliance section listing all deprecated versions"
      ]
    },
    {
      "id": 7,
      "prompt": "Analyze the tests/analyze-gitops-repo/bad-structure/ directory as a GitOps repository and provide a complete analysis report.",
      "expected_output": "A report identifying critical structural issues: flat layout with no separation, everything in default namespace, hardcoded password, insecure source, unpinned chart versions, missing prune/dependsOn/driftDetection.",
      "files": [],
      "expectations": [
        "Flags the flat directory structure with no apps/infrastructure/clusters separation",
        "Flags everything deployed to the default namespace instead of per-app namespaces",
        "Detects the hardcoded password (supersecret123) in redis.yaml values",
        "Detects insecure: true on the ingress-nginx HelmRepository",
        "Flags unpinned chart versions (version: '*' or missing version)",
        "Notes missing prune: true on the Kustomization",
        "Notes missing dependsOn between Kustomization and HelmReleases",
        "Notes missing drift detection on all HelmReleases",
        "Notes missing remediation/retry strategy on all HelmReleases",
        "Flags HelmRepository with type: oci as legacy, recommends migration to OCIRepository",
        "Reports overall status as critical-issues",
        "Produces a structured report with security findings and recommendations"
      ]
    }
  ]
}
