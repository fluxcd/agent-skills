{
  "skill_name": "gitops-repo-audit",
  "evals": [
    {
      "id": 1,
      "prompt": "Analyze the tests/gitops-repo-audit/monorepo-structure/ directory as a GitOps repository and provide a complete analysis report.",
      "expected_output": "A comprehensive analysis report identifying this as a monorepo pattern with two clusters (staging and production), FluxInstance with GitRepository sync, ArtifactGenerator for monorepo decomposition, Kustomize base/overlay pattern, modern HelmRelease patterns, and recommendations for cluster.size, GitHub App auth, and notifications.",
      "files": [],
      "expectations": [
        "Identifies the repository as a monorepo pattern with apps/infrastructure/clusters structure",
        "Detects two clusters: staging and production",
        "Detects FluxInstance resources with sync.kind GitRepository",
        "Identifies ArtifactGenerator usage for monorepo decomposition into ExternalArtifacts",
        "Finds HelmRelease and OCIRepository resources",
        "Notes the dependency chain: infra-controllers depends on nothing, infra-configs depends on infra-controllers, apps depends on infra-configs",
        "Recognizes the Kustomize base/overlay pattern in apps/ with per-environment patches",
        "Notes modern install.strategy and upgrade.strategy on HelmReleases",
        "Detects drift detection enabled on HelmReleases",
        "Checks for deprecated API versions and reports findings",
        "Produces a structured report with summary, structure, best practices, and recommendations sections"
      ]
    },
    {
      "id": 2,
      "prompt": "Analyze the tests/gitops-repo-audit/multi-repo-structure/ directory as a GitOps repository and provide a complete analysis report.",
      "expected_output": "A comprehensive analysis report identifying this as an OCI-based multi-repo fleet management pattern using FluxInstance with OCIRepository sync, ResourceSet templates for multi-tenant resource generation, Cosign signature verification, ValidatingAdmissionPolicy for source allowlist, and recommendations for dependency ordering and notifications.",
      "files": [],
      "expectations": [
        "Identifies the repository as an OCI-based multi-repo fleet management pattern",
        "Detects FluxInstance resources with sync.kind OCIRepository and multitenant: true",
        "Identifies ResourceSet resources for templated multi-tenant resource generation",
        "Detects multiple clusters: staging and production",
        "Notes the OCI artifact sync strategy with tag promotion (latest for staging vs latest-stable for production)",
        "Identifies ValidatingAdmissionPolicy for source allowlist enforcement",
        "Notes Cosign signature verification on OCI sources within ResourceSet templates",
        "Detects dedicated ServiceAccounts and RoleBindings per tenant for RBAC isolation",
        "Notes postBuild.substituteFrom for cluster-specific variable injection",
        "Produces a structured report with summary, structure, best practices, and recommendations sections"
      ]
    },
    {
      "id": 3,
      "prompt": "Analyze the tests/gitops-repo-audit/deprecated-apis/ directory as a GitOps repository and provide a complete analysis report.",
      "expected_output": "A report flagging multiple deprecated Flux API versions across all resource types, recommending migration to current versions, and noting gotk-sync.yaml means flux bootstrap is used.",
      "files": [],
      "expectations": [
        "Detects GitRepository using source.toolkit.fluxcd.io/v1beta1 (should be v1)",
        "Detects Kustomization using kustomize.toolkit.fluxcd.io/v1beta1 and v1beta2 (should be v1)",
        "Detects HelmRelease using helm.toolkit.fluxcd.io/v2beta1 and v2beta2 (should be v2)",
        "Detects HelmRepository using source.toolkit.fluxcd.io/v1beta1 and v1beta2 (should be v1)",
        "Detects Provider using notification.toolkit.fluxcd.io/v1beta1 (should be v1beta3)",
        "Detects Alert using notification.toolkit.fluxcd.io/v1beta2 (should be v1beta3)",
        "Flags HelmRepository with type: oci as legacy, recommends migration to OCIRepository",
        "Detects gotk-sync.yaml and recommends migrating to Flux Operator with link to https://fluxoperator.dev/docs/guides/migration/",
        "Reports overall status as critical-issues due to deprecated APIs",
        "Produces a structured report with API compliance section listing all deprecated versions"
      ]
    },
    {
      "id": 4,
      "prompt": "Analyze the tests/gitops-repo-audit/bad-structure/ directory as a GitOps repository and provide a complete analysis report.",
      "expected_output": "A report identifying critical structural issues: flat layout with no separation, everything in default namespace, hardcoded password, insecure source, unpinned chart versions, missing prune/dependsOn/driftDetection.",
      "files": [],
      "expectations": [
        "Flags the flat directory structure with no apps/infrastructure/clusters separation",
        "Flags everything deployed to the default namespace instead of per-app namespaces",
        "Detects the hardcoded password (supersecret123) in redis.yaml values",
        "Detects insecure: true on the ingress-nginx HelmRepository",
        "Flags unpinned chart versions (version: '*' or missing version)",
        "Notes missing prune: true on the Kustomization",
        "Notes missing dependsOn between Kustomization and HelmReleases",
        "Notes missing drift detection on all HelmReleases",
        "Notes missing remediation/retry strategy on all HelmReleases",
        "Flags HelmRepository with type: oci as legacy, recommends migration to OCIRepository",
        "Reports overall status as critical-issues",
        "Produces a structured report with security findings and recommendations"
      ]
    }
  ]
}
